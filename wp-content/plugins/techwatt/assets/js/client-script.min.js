jQuery(document).ready((function(e){function t(t,o="success"){const a=e("#msgbox"),n={success:{bg:"#d4edda",text:"#155724",icon:"✅"},error:{bg:"#f8d7da",text:"#721c24",icon:"❌"},warning:{bg:"#fff3cd",text:"#856404",icon:"⚠️"},info:{bg:"#cce5ff",text:"#004085",icon:"ℹ️"}},c=n[o]||n.success;a.html(`${c.icon} ${t}`).css({"background-color":c.bg,color:c.text,display:"none"}).stop(!0,!0).fadeIn(200).delay(1e4).fadeOut(600)}document.querySelectorAll(".tw-info-icon").forEach((e=>{e.addEventListener("click",(function(e){let t=document.querySelector(".tw-info-popup");t&&t.remove();const o=document.createElement("div");o.className="tw-info-popup",o.innerHTML=this.dataset.full,Object.assign(o.style,{position:"absolute",background:"#fff",color:"#333",border:"1px solid #ccc",padding:"8px 10px",fontSize:"13px",maxWidth:"250px",borderRadius:"6px",boxShadow:"0 2px 6px rgba(0,0,0,0.2)",zIndex:9999,top:e.pageY+5+"px",left:e.pageX+5+"px"}),document.body.appendChild(o);const a=()=>{o.remove(),document.removeEventListener("click",a)};setTimeout((()=>document.addEventListener("click",a)),0)}))})),setTimeout((function(){var e=document.querySelector('input[name="username"]'),t=document.querySelector('input[type="password"]');e&&(e.value=""),t&&(t.value="")}),500),e("#cbtncancel").on("click",(function(){e("#cmsgbox").fadeOut(),e("#psRegFrm").fadeIn()})),e(document).on("submit","#psFrm,#psFrm1,#psFrm2,#tm-form",(async function(o){o.preventDefault();const a=o.target,n=a.querySelector("button[type='submit']"),c=n.textContent;n.disabled=!0,n.textContent="Submitting...";const s=a.getAttribute("id"),i=new FormData(a),r=a.getAttribute("action");try{const n=await fetch(r,{method:"POST",body:i,credentials:"same-origin",cache:"no-cache",headers:{"X-WP-Nonce":TWREST.nonce}}),c=await n.text();let d;console.log(d);try{d=JSON.parse(c)}catch(o){d={success:!1,data:{message:`Request failed with status ${c}`}}}d.success?("psRegFrm"===s?(a.reset(),e("#psRegFrm").fadeOut(),e("#cmsgbox").fadeIn()):t(`${d.data.message}`,"success"),d?.data?.redirect&&(window.location.href=d.data.redirect),"psFrm1"!==s&&"psFrm2"!==s&&"tm-form"!==s||a.reset(),"tm-form"===s&&window.reload(),history.replaceState(null,"",location.href)):t(`${d.data.message}`,"error")}catch(e){t(`${e.message||e}`,"error")}finally{n.disabled=!1,n.textContent=c}})),e(document).on("submit","#psRegFrm",(async function(o){o.preventDefault();const a=o.target,n=a.querySelector("button[type='submit']"),c=n.textContent;n.disabled=!0,n.textContent="Submitting...";const s=a.getAttribute("id"),i=new FormData(a),r=a.getAttribute("action");try{const n=await fetch(r,{method:"POST",body:i,credentials:"same-origin",cache:"no-cache",headers:{"X-WP-Nonce":TWREST.nonce}}),c=await n.text();let d;try{d=JSON.parse(c)}catch(o){d={success:!1,message:`Request failed with status ${c}`}}d.success?("psRegFrm"===s?(a.reset(),e("#psRegFrm").fadeOut(),d.paidnow?(e("#pmsgbox").fadeIn(),e(".pbtnpay").data("uid",d.data.uid),e(".pbtnpay").data("childid",d.data.childid),e(".pbtnpay").data("amount",d.data.cost),e(".pbtnpay").data("name",i.get("parentname")),e(".pbtnpay").data("email",i.get("email")),e("#pbtncost").html(` (£${d.data.cost})`)):e("#cmsgbox").fadeIn()):t(`${d.message}`,"success"),"psFrm1"!==s&&"tm-form"!==s||a.reset(),"tm-form"===s&&window.reload(),history.replaceState(null,"",location.href)):t(`${d.message}`,"error")}catch(e){t(`${e.message||e}`,"error")}finally{n.disabled=!1,n.textContent=c}})),e(document).on("change","#tw_package",(function(){let t=e(this).val(),o=null;"bronze"==t?(e("#packageinfo").show(100).html("Our <b>Bronze Package</b> is perfect for self-starters. It does not include a Robotics Kit, and students are required to purchase their own kit separately. Classes are conducted in larger groups of up to 30 students, offering a community-based learning experience at an affordable rate."),o=["robotics"]):"silver"==t?(e("#packageinfo").show(100).html("The <b>Silver Package</b> includes a Robotics Kit and provides interactive group lessons with up to 20 students per class. This package is ideal for learners who enjoy collaboration and teamwork while still receiving quality instruction."),o=["robotics"]):"gold"==t?(e("#packageinfo").show(100).html("Our <b>Gold Package</b> offers a complete Robotics experience. Students receive a Robotics Kit and enjoy personalized one-on-one sessions twice a week. Each learner also gets access to all previous class recordings, ensuring continuous learning and revision at their own pace."),o=["robotics"]):(e("#packageinfo").html("").hide(10),o=null),e("#tw_course option").each((function(){o?o.includes(e(this).val())?e(this).prop("disabled",!1):""!==e(this).val()?e(this).prop("disabled",!0):e(this).prop("selected",!0):e(this).prop("disabled",!1)}))})),e(document).on("click","#btn-cancel-course",(function(){var t=e(this);if(!confirm("Are you sure you want to cancel this course booking? Deleting this course cannot be undone."))return;const o=t.html();t.on("click.disabled",(function(e){e.preventDefault()})),t.html("Deleting...");var a=t.data("childid"),n=t.data("uid"),c=t.data("apicall"),s=TWREST.root+c;e.ajax({url:s,method:"POST",beforeSend:function(e){e.setRequestHeader("X-WP-Nonce",TWREST.nonce)},data:{childid:a,uid:n},success:function(e){e.success?(alert(`Course #${a} cancelled successfully.`),location.reload()):alert("Error: "+e.message)},error:function(e){console.log(e)},complete:function(){t.html(o),t.off("click.disabled")}})})),e(document).on("click","#stripe-pay-btn",(function(){var t=e(this);const o=t.html();t.on("click.disabled",(function(e){e.preventDefault()})),t.html("Processing...");var a=t.data("amount");a=parseFloat(a).toFixed(2);var n=t.data("currency"),c=t.data("childid"),s=t.data("uid"),i=t.data("name"),r=t.data("email"),d=t.data("apicall"),l=TWREST.root+d;e.ajax({url:l,method:"POST",beforeSend:function(e){e.setRequestHeader("X-WP-Nonce",TWREST.nonce)},data:{amount:a,currency:n,childid:c,uid:s,name:i,email:r},success:function(e){e.success?Stripe(TWREST.stripe_pk).redirectToCheckout({sessionId:e.data.id}):alert("Error: "+e.message)},error:function(e){console.log(e)},complete:function(){t.html(o),t.off("click.disabled")}})})),e(document).on("click",".tw-close, #tw-popup-overlay",(function(t){t.target===this&&e("#tw-popup-overlay").fadeOut(150)})),e(document).on("click",".open-popup, #profile-felix, #profile-sam, #profile-johnson, #profile-maxwell, #profile-femi",(function(t){t.preventDefault();var o,a=e(this).attr("id").split("-")[1];if(a){var n=e("#content-"+a).html();o=n,e("#tw-popup .tw-content").html(o),e("#tw-popup-overlay").fadeIn(150)}})),e(".tw-forgotpwd").on("click",(function(t){t.preventDefault(),e(".tw-regfrm").hide(),e(".tw-fpwdfrm").show()})),e(".tw-back2login").on("click",(function(t){t.preventDefault(),e(".tw-fpwdfrm").hide(),e(".tw-regfrm").show()}))}));const msg=document.getElementById("msgbox");